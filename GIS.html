<!DOCTYPE html>
<html>

<head>
  <title>OpenLayers Map with GeoServer Layer</title>
  <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">

  <script src="semantic/dist/semantic.min.js"></script>
  <link rel="stylesheet" href="https://openlayers.org/en/v6.5.0/css/ol.css" type="text/css">
  <script src="https://openlayers.org/en/v6.5.0/build/ol.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
  <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  <script src="semantic/dist/semantic.min.js"></script>
  <style>
    .ui.styled.accordion .accordion .content,
    .ui.styled.accordion .content {
      padding: 0.5em 1em 0.5em;
    }

    .ui.tabular.menu+.attached:not(.top).segment,
    .ui.tabular.menu+.attached:not(.top).segment+.attached:not(.top).segment {
      width: 550px;
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ "Legend" */
    #controls h3 {
      font-size: 20px;
      color: #333;
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ "Search" */
    #searchInput,
    #searchButton {
      font-size: 16px;
    }

    /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –≤–≤–æ–¥–∞ "Search" */
    #searchInput {
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞ "Search" */
    #searchButton {
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞ "Search" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    #searchButton:hover {
      background-color: #0056b3;
    }


    #controls {
      margin-left: 20px;
      padding: 10px;
    }


    #controls h2 {
      font-size: 18px;
    }


    .control-input {
      margin-bottom: 5px;
    }

    .control-button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
    }

    .control-button:hover {
      background-color: #0056b3;
    }

    /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –∫–ª–∞—Å—Å–æ–≤ */
    .class-switch-label {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .class-switch-label input[type="checkbox"] {
      display: none;
    }

    .class-switch-label .class-switch-icon {
      font-size: 24px;
      margin-right: 10px;
      color: #007bff;
    }

    .class-switch-label input[type="checkbox"]:checked+.class-switch-icon {
      color: #00b33c;
    }

    .class-switch-label .class-switch-name {
      cursor: pointer;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ "Show/Hide Layer" */
    .toggle-label {
      display: flex;
      align-items: center;
    }

    .hidden-button {
      display: none;
    }

    .toggle-checkbox {
      display: none;
    }

    .toggle-icon {
      font-size: 24px;
      margin-right: 10px;
      color: #007bff;
    }

    .toggle-checkbox:checked+.toggle-icon {
      color: #00b33c;
    }

    #coordinates-list {
      max-height: 80px;
      overflow-y: auto;
    }


    #coordinates-list-large-vehicle {
      max-height: 80px;
      overflow-y: auto;
    }

    .object-item {
      margin: 5px;
      cursor: pointer;
    }

    .Info {
      display: none;
      /* –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ */
    }


    .Info {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    #Class {
      font-size: 24px;
      font-weight: bold;
      color: blue;
      /* –¶–≤–µ—Ç –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –≤–∞—à –≤–∫—É—Å */
      margin-bottom: 10px;
    }

    #selected-info {
      font-size: 16px;
    }


    .selected {
      font-weight: bold;
      color: #4CAF50;
      /* –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç —Ü–≤–µ—Ç –Ω–∞ –∂–µ–ª–∞–µ–º—ã–π */
    }


    .ui.tabular.menu+.attached:not(.top).segment,
    .ui.tabular.menu+.attached:not(.top).segment+.attached:not(.top).segment {
      width: 550px;
      padding-bottom: 8px;
    }

    .infoblock {
      max-width: 300px;
      margin: 20px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      display: none;
    }

    .Info {
      color: #333;
    }

    #Class {
      margin-top: 10px;
      font-size: 1.5em;
      color: #3498db;
    }

    #selected-info {
      padding: 10px;
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .layer-switch {
      position: relative;
    }

    .toggle-label {
      display: flex;
      cursor: pointer;
    }

    .toggle-label span {
      font-size: 24px;
      padding: 0 10px;
      transition: color 0.3s;
    }

    #layerToggle {
      display: none;
    }

    #layerToggle:checked+.toggle-label .individual-trees-icon {
      color: #888;
    }

    .toggle-container {
      display: flex;
    }

    .toggle {
      cursor: pointer;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 0 5px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background-color 0.3s;
    }

    .toggle img {
      width: 50px;
      height: 50px;
      margin-bottom: 5px;
    }

    .toggle.active {
      background-color: #87CEEB;
      /* –¶–≤–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ–≥–∞ */
      color: #fff;
    }

    #layerToggle:checked+.toggle-label .combined-layer-icon {
      color: #2ecc71;
    }

    .second_container {
      justify-content: space-between;
      display: flex;
    }
  </style>
</head>

<body>
  <div style="display: flex;">
    <div id="map" style="width: 80%; height: 640px; float: left;"></div>
    <div id="controls">
      <div id="legend">
        <h3>–õ–µ–≥–µ–Ω–¥–∞</h3>
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è/—Å–∫—Ä—ã—Ç–∏—è —Å–ª–æ—è -->
        <label for="layerSwitch" class="toggle-label">
          <input type="checkbox" id="layerSwitch" class="toggle-checkbox" checked>
          <i class="fas fa-layer-group toggle-icon"></i> –ü–æ–∫–∞–∑–∞—Ç—å/–£–±—Ä–∞—Ç—å —Å–ª–æ–π
        </label>
        <div class="ui top attached tabular menu">
          <a class="active item" data-tab="first">–ú–∞—à–∏–Ω—ã</a>
          <a class="item" data-tab="second">–î–µ—Ä–µ–≤—å—è</a>
        </div>
        <div class="ui bottom attached active tab segment" data-tab="first">
          <div class="Cars">
            <div class="ui styled accordion" style="margin-top:10px ;">
              <div class="title">
                <i class="dropdown icon"></i>
                –õ–µ–≥–∫–æ–≤–∞—è –º–∞—à–∏–Ω–∞ <i class="fas fa-car "></i>
              </div>
              <div class="content">
                <label class="class-switch-label">
                  <input type="checkbox" class="class-switch toggle-checkbox" value="small-vehicle">
                  <i class="fas fa-car class-switch-icon toggle-icon"></i>
                  <span class="class-switch-name header">–õ–µ–≥–∫–æ–≤–∞—è –º–∞—à–∏–Ω–∞</span>
                </label>
                <ul id="coordinates-list"></ul>
              </div>
              <div class="content">
                <label class="class-switch-label">
                </label>
              </div>
              <div class="title">
                <i class="dropdown icon"></i>
                –ì—Ä—É–∑–æ–≤–∏–∫ <i class="class-switch-icon fas fa-truck-pickup checked"></i>
              </div>
              <div class="content">
                <label class="class-switch-label">
                  <input type="checkbox" class="class-switch" value="large-vehicle">
                  <i class="class-switch-icon fas fa-truck-pickup checked"></i>
                  <span class="class-switch-name header">–ì—Ä—É–∑–æ–≤–∏–∫</span>
                </label>
                <ul id="coordinates-list-large-vehicle"></ul>
              </div>
              <div class="title">
                <i class="dropdown icon"></i>
                –ú–æ—Å—Ç <i class="fas fa-bridge class-switch-icon"></i>
              </div>
              <div class="content">
                <label class="class-switch-label">
                  <input type="checkbox" class="class-switch" value="bridge">
                  <i class="fas fa-bridge class-switch-icon"></i>
                  <span class="class-switch-name header">–ú–æ—Å—Ç</span>
                </label>
                <ul id="coordinates-list-bridge"></ul>
              </div>
            </div>
            <div class="infoblock">
              <h3 class="Info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
              <h2 id="Class"></h2>
              <div id="selected-info">
              </div>
            </div>
          </div>
        </div>

        <div class="ui bottom attached tab segment" data-tab="second">
          <div class="second_container">
            <label class="class-switch-label">
              <input type="checkbox" class="class-switch toggle-checkbox" value="trees" id="treeToggleCheckbox">
              <i class="fas fa-tree class-switch-icon toggle-icon" id="treeToggleIcon"></i>
              <span class="class-switch-name header">–î–µ—Ä–µ–≤—å—è</span>
            </label>
            <div class="ui toggle checkbox">
              <input type="checkbox" name="public">
              <label>
                <span class="individual-trees-icon">üå≥</span>
                /
                <span class="combined-layer-icon">üèûÔ∏è</span>
              </label>
            </div>
          </div>
          <div id="featureCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤: 0</div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
        <script>
          $('.menu .item').tab();
        </script>
      </div>
    </div>
  </div>


  <script type="text/javascript">

    var layerSwitch = document.getElementById('layerSwitch');
    var searchButton = document.getElementById('searchButton');
    var searchInput = document.getElementById('searchInput');
    var classSwitches = document.querySelectorAll('.class-switch');

    var layer1 = new ol.layer.Image({
      source: new ol.source.ImageWMS({
        url: '/geoserver/web_map/tif/wms',
        params: {
          'LAYERS': 'tif',
        },
      }),
    });


    var shpLayer = new ol.layer.Image({
      source: new ol.source.ImageWMS({
        url: '/geoserver/tif/cars/wms',
        params: {
          'LAYERS': 'cars',
        },
        serverType: 'geoserver',
      })
    });


    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤
    classSwitches.forEach(function (switchElement) {
      switchElement.addEventListener("change", function () {
        var selectedClasses = [];
        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã
        classSwitches.forEach(function (checkbox) {
          if (checkbox.checked) {
            selectedClasses.push(checkbox.value);
          }
        });

        if (shpLayer instanceof ol.layer.Image) {
          var source = shpLayer.getSource();
          var layerClass = source.getParams().LAYERS;
          if (selectedClasses.length === 0 || selectedClasses.includes(layerClass)) {
            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ –∏–ª–∏ —Ç–µ–∫—É—â–∏–π —Å–ª–æ–π –≤–∫–ª—é—á–µ–Ω, –æ—Ç–æ–±—Ä–∞–∑–∏—Ç–µ —Å–ª–æ–π –∏ —É–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä
            shpLayer.setVisible(false);
            source.updateParams({ CQL_FILTER: "" });
          } else {
            // –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, —Å–∫—Ä–æ–π—Ç–µ —Å–ª–æ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
            shpLayer.setVisible(true);
            source.updateParams({ CQL_FILTER: "CLASS IN ('" + selectedClasses.join("','") + "')" });
          }
        }
      });
    });
    function showInfo() {
      // –ü–æ–ª—É—á–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º 'Info'
      var infoElement = document.getElementsByClassName('infoblock')[0];
      infoElement.style.display = 'block';
    }
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª–∞—Å—Å—É –æ–±—ä–µ–∫—Ç–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ
    function fetchDataByClass(objectClass, listId) {
      var Filter = new ol.format.filter.EqualTo('CLASS', objectClass);
      var wfsRequest = new ol.format.WFS().writeGetFeature({
        srsName: 'EPSG:4326',
        featureTypes: ['cars'],
        outputFormat: 'application/json',
        filter: Filter,
      });

      fetch('/geoserver/tif/cars/wfs', {
        method: 'POST',
        body: new XMLSerializer().serializeToString(wfsRequest),
        headers: new Headers({
          'Content-Type': 'text/xml',
        }),
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (json) {
          var features = json.features;
          var coordinatesList = document.getElementById(listId);
          var Info = document.getElementsByClassName('infoblock');
          var selectedInfo = document.getElementById('selected-info');
          var Class = document.getElementById('Class');
          coordinatesList.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ø–∏—Å–æ–∫
          var objectLayers = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–æ–µ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
          features.forEach(function (feature, i) {
            var geometry = feature.geometry;
            var coordinates = geometry.coordinates[0][0][0];
            var vehicleClass = feature.properties.CLASS;
            var ID = feature.properties.ID;
            var objectLayer = new ol.layer.Vector({
              source: new ol.source.Vector(),
              visible: false,
            });
            objectLayers.push(objectLayer);
            var listItem = document.createElement('div');
            listItem.classList.add('object-item');
            listItem.textContent = getObjectLabel(objectClass, i);
            listItem.addEventListener('click', function () {
              var index = parseInt(this.textContent.split(' ')[1]) - 1;
              var selectedCoordinates = features[index].geometry.coordinates[0][0][0];
              var Coordinate = features[index].geometry.coordinates[0][0];
              var pred = features[index].properties.PRED;
              var listItems = document.querySelectorAll('.object-item');
              listItems.forEach(function (item) {
                item.classList.remove('selected');
              });
              this.classList.add('selected');
              Class.innerHTML = getObjectTitle(objectClass);
              selectedInfo.innerHTML = '<b>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</b> ' + '<br>–î–æ–ª–≥–æ—Ç–∞: ' + selectedCoordinates[0] +
                '<br>–®–∏—Ä–æ—Ç–∞: ' + selectedCoordinates[1] + '<br>' + '<br> Confidences: ' + pred;
              selectedInfo.style.display = 'block';
              showInfo();

              objectLayers.forEach(function (layer) {
                layer.getSource().clear();
                layer.setVisible(false);
              });

              // –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –ø–æ–ª–∏–≥–æ–Ω–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –Ω–∞ –∫–∞—Ä—Ç—É
              var feature = new ol.Feature({
                geometry: new ol.geom.Polygon([[
                  ol.proj.fromLonLat(Coordinate[0]),
                  ol.proj.fromLonLat(Coordinate[1]),
                  ol.proj.fromLonLat(Coordinate[2]),
                  ol.proj.fromLonLat(Coordinate[3]),
                  ol.proj.fromLonLat(Coordinate[4]),
                  ol.proj.fromLonLat(Coordinate[0]),
                ]]),
              });

              objectLayers[index].getSource().addFeature(feature);

              var lon = selectedCoordinates[0];
              var lat = selectedCoordinates[1];
              map.getView().setCenter(ol.proj.fromLonLat([lon, lat]));
              map.getView().setZoom(21);
              objectLayers[index].setVisible(true);
            });
            coordinatesList.appendChild(listItem);
          });
          objectLayers.forEach(function (layer) {
            map.addLayer(layer);
          });
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞
    function getObjectTitle(objectClass) {
      switch (objectClass) {
        case 'small-vehicle':
          return '–õ–µ–≥–∫–æ–≤–∞—è –º–∞—à–∏–Ω–∞';
        case 'large-vehicle':
          return '–ì—Ä—É–∑–æ–≤–∏–∫';
        case 'bridge':
          return '–ú–æ—Å—Ç';
        default:
          return '';
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∫–∏ –æ–±—ä–µ–∫—Ç–∞
    function getObjectLabel(objectClass, index) {
      switch (objectClass) {
        case 'small-vehicle':
          return '–õ–µ–≥–∫–æ–≤–∞—è ' + (index + 1);
        case 'large-vehicle':
          return '–ì—Ä—É–∑–æ–≤–∞—è ' + (index + 1);
        case 'bridge':
          return '–ú–æ—Å—Ç ' + (index + 1);
        default:
          return '';
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      fetchDataByClass('small-vehicle', 'coordinates-list');
      fetchDataByClass('large-vehicle', 'coordinates-list-large-vehicle');
      fetchDataByClass('bridge', 'coordinates-list-bridge');
    });


    layerSwitch.addEventListener('change', function () {
      allLayers.forEach(function (layer) {
        layer.setVisible(layerSwitch.checked);
      });
    });



    var map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        }),
        layer1,
        shpLayer,
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([30.800289, 59.662412]),
        zoom: 15,
      })
    });



    shpLayer.setVisible(false);
    var allLayers = [layer1, shpLayer, activeTreesLayer];

    var wfsLayer = new ol.layer.Vector({
      source: wfsSource,
    })
    wfsLayer.setVisible(false);
    map.addLayer(wfsLayer);


    var isCtrlPressed = false; // –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –∑–∞–∂–∞—Ç–∞ –ª–∏ –∫–ª–∞–≤–∏—à–∞ Ctrl

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞–≤–∏—à–∏ Ctrl
    document.addEventListener('keydown', function (event) {
      if (event.key === 'Control') {
        isCtrlPressed = true;
      }
    });

    document.addEventListener('keyup', function (event) {
      if (event.key === 'Control') {
        isCtrlPressed = false;
      }
    });

    // –°–æ–∑–¥–∞–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ DragBox
    var dragBox = new ol.interaction.DragBox({
      condition: ol.events.condition.platformModifierKeyOnly,
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É
    map.addInteraction(dragBox);

    var wfsSource = new ol.source.Vector({
      format: new ol.format.GeoJSON(),
      url: function (extent, resolution, projection) {
        return '/geoserver/tif/cars/wfs?' +
          'service=WFS&version=1.1.0&request=GetFeature' +
          '&typename=cars' +
          '&outputFormat=application/json' +
          '&srsname=EPSG:4326' +
          '&bbox=' + extent.join(',') + ',EPSG:4326';
      },
    });

    var wfsLayer = new ol.layer.Vector({
      source: wfsSource,
      opacity: 0,
    })
    wfsLayer.setVisible(true);
    map.addLayer(wfsLayer);

    var treeStyle = new ol.style.Style({
      fill: new ol.style.Fill({
        color: 'transparent', // Set the fill color to transparent to remove the fill
      }),
      stroke: new ol.style.Stroke({
        color: 'rgba(0, 255, 0, 0.3)', // Set the stroke color to green or any desired color
        width: 1, // Set the stroke width to control the thickness of the border
      }),
    });



    var wfsSourceTrees = new ol.source.Vector({
      format: new ol.format.GeoJSON(),
      url: function (extent, resolution, projection) {
        return '/geoserver/web_map/tree-0-0/wfs?' +
          'service=WFS&version=1.1.0&request=GetFeature' +
          '&typename=tree-0-0' +
          '&outputFormat=application/json' +
          '&srsname=EPSG:4326' +
          '&bbox=' + extent.join(',') + ',EPSG:4326';
      },
    });





    var wfsLayerTrees = new ol.layer.Vector({
      source: wfsSourceTrees,
      style: treeStyle,
    });

    wfsLayerTrees.setVisible(false);
    map.addLayer(wfsLayerTrees);

    var tree = new ol.layer.Image({
      source: new ol.source.ImageWMS({
        url: 'geoserver/trees/tif-0-0_preds/wms',
        params: {
          'LAYERS': 'tif-0-0_preds ',
        },
      }),
      opacity: 0.8,
    });

    tree.setVisible(false);
    map.addLayer(tree);





    // Add event listener to the checkbox
    $('#treeToggleCheckbox').change(function () {
      var isChecked = $(this).prop('checked');
      wfsLayerTrees.setVisible(isChecked);
    });

    var activeTreesLayer = wfsLayerTrees;

    $('#treeToggleCheckbox').change(function () {
      var isChecked = $(this).prop('checked');
      activeLayer.setVisible(isChecked);
    });

    // Add event listener to the tree layer toggle checkbox
    $('#treeLayerToggleCheckbox').change(function () {
      var isChecked = $(this).prop('checked');

      // –í—ã–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–ª–æ–π
      activeLayer.setVisible(false);

      if (isChecked) {
        // –í–∫–ª—é—á–∞–µ–º –Ω–æ–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–ª–æ–π (tree)
        tree.setVisible(true);
        activeLayer = tree;
      } else {
        // –í–∫–ª—é—á–∞–µ–º –Ω–æ–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–ª–æ–π (wfsLayerTrees)
        wfsLayerTrees.setVisible(true);
        activeLayer = wfsLayerTrees;
      }
    });




    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ DragBox
    var dragBox = new ol.interaction.DragBox({
      condition: ol.events.condition.platformModifierKeyOnly,
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É
    map.addInteraction(dragBox);


    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è DragBox
    dragBox.on('boxend', function () {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∂–∞—Ç–∞ –ª–∏ –∫–ª–∞–≤–∏—à–∞ Ctrl
      if (isCtrlPressed) {
        // –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –æ–±—ä–µ–∫—Ç–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Å–ª–æ—è –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
        var extent = dragBox.getGeometry().getExtent();
        var features = wfsLayerTrees.getSource().getFeaturesInExtent(extent);
        console.log('Number of features in the extent:', features.length);
        featureCount.innerHTML = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤: ' + features.length;

      }
    });


  </script>

  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ Semantic UI
    $('.ui.accordion').accordion();
  </script>
</body>

</html>