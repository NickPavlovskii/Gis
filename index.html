<!DOCTYPE html>
<html>
<head>
  <title>OpenLayers Map with GeoServer Layer</title>
  <link rel="stylesheet" href="https://openlayers.org/en/v6.5.0/css/ol.css" type="text/css">
  <script src="https://openlayers.org/en/v6.5.0/build/ol.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">
  <style>
    /* Стиль для заголовка "Legend" */
    #controls h3 {
      font-size: 20px;
      color: #333;
    }

    /* Стиль для заголовка "Search" */
    #searchInput,
    #searchButton {
      font-size: 16px;
    }

    /* Стиль для текстового поля ввода "Search" */
    #searchInput {
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    /* Стиль для кнопки поиска "Search" */
    #searchButton {
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Стиль для кнопки поиска "Search" при наведении */
    #searchButton:hover {
      background-color: #0056b3;
    }

    /* Стилизация контейнера */
    #controls {
      margin-left: 20px;
      padding: 10px;
    }

    /* Стилизация заголовка */
    #controls h2 {
      font-size: 18px;
    }

    /* Стилизация элементов управления */
    .control-input {
      margin-bottom: 5px;
    }

    .control-button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
    }

    .control-button:hover {
      background-color: #0056b3;
    }

    /* Стилизация переключателей классов */
    .class-switch-label {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .class-switch-label input[type="checkbox"] {
      display: none;
    }

    .class-switch-label .class-switch-icon {
      font-size: 24px;
      margin-right: 10px;
      color: #007bff;
    }

    .class-switch-label input[type="checkbox"]:checked + .class-switch-icon {
      color: #00b33c;
    }

    .class-switch-label .class-switch-name {
      cursor: pointer;
    }

    /* Стили для элемента "Show/Hide Layer" */
    .toggle-label {
      display: flex;
      align-items: center;
    }

    .toggle-checkbox {
      display: none;
    }

    .toggle-icon {
      font-size: 24px;
      margin-right: 10px;
      color: #007bff;
    }

    /* Стили для изменения цвета иконки при включенном состоянии */
    .toggle-checkbox:checked + .toggle-icon {
      color: #00b33c;
    }
  </style>
</head>
<body>
  <div style="display: flex;">
    <div id="map" style="width: 80%; height: 500px; float: left;"></div>
 
      </div>
    </div>
  </div>
  <script type="text/javascript">




// // Создание источника данных WFS
// var wfsSource = new ol.source.Vector({
//     format: new ol.format.GeoJSON(),
//     url: function (extent, resolution, projection) {
//         return 'http://localhost:8081/geoserver/tif/cars/wfs?' +
//             'service=WFS&version=1.1.0&request=GetFeature' +
//             '&typename=cars' +
//             '&outputFormat=application/json' +
//             '&srsname=EPSG:4326' +
//             '&bbox=' + extent.join(',') + ',EPSG:4326';
//     },
// });




    var map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        }),
      

      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([30.800289, 59.662412]),
        zoom: 15,
      })
    });





    var isCtrlPressed = false; // Флаг, указывающий, зажата ли клавиша Ctrl

// Обработчик событий для отслеживания состояния клавиши Ctrl
document.addEventListener('keydown', function (event) {
  if (event.key === 'Control') {
    isCtrlPressed = true;
  }
});

document.addEventListener('keyup', function (event) {
  if (event.key === 'Control') {
    isCtrlPressed = false;
  }
});

// Создаем взаимодействие DragBox
var dragBox = new ol.interaction.DragBox({
  condition: ol.events.condition.platformModifierKeyOnly,
});

// Добавляем взаимодействие на карту
map.addInteraction(dragBox);

// Обработчик события для DragBox
// Создание источника данных WFS
var wfsSource = new ol.source.Vector({
    format: new ol.format.GeoJSON(),
    url: function (extent, resolution, projection) {
        return 'http://localhost:8081/geoserver/tif/cars/wfs?' +
            'service=WFS&version=1.1.0&request=GetFeature' +
            '&typename=cars' +
            '&outputFormat=application/json' +
            '&srsname=EPSG:4326' +
            '&bbox=' + extent.join(',') + ',EPSG:4326';
    },
});

var wfsLayer = new ol.layer.Vector({
  source: wfsSource,
  opacity: 0,
})
wfsLayer.setVisible(true);
map.addLayer(wfsLayer);


// Добавляем взаимодействие DragBox
var dragBox = new ol.interaction.DragBox({
  condition: ol.events.condition.platformModifierKeyOnly,
});

// Добавляем взаимодействие на карту
map.addInteraction(dragBox);

// Обработчик события для DragBox
dragBox.on('boxend', function () {
  // Проверяем, зажата ли клавиша Ctrl
  if (isCtrlPressed) {
    // Выводим информацию о каждом объекте векторного слоя в выделенной области
    var extent = dragBox.getGeometry().getExtent();
    var features = wfsLayer.getSource().getFeaturesInExtent(extent);
    console.log('Number of features in the extent:', features.length);

    // Выводим информацию о каждом объекте векторного слоя в данной области
    features.forEach(function (feature) {
      console.log('ID:', feature.getId());
      console.log('CLASS:', feature.getProperties().CLASS);
      console.log('Geometry:', feature.getGeometry().getType());
      console.log('---');
    });

 
  }
});





  </script>
</body>
</html>
